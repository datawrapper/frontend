<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <meta name="theme-color" content="#333333" />

        <link rel="stylesheet" href="https://static.dwcdn.net/css/roboto-bitter.css" />
        <link
            rel="manifest"
            href="manifest.json"
            crossorigin="use-credentials"
        />
        <link rel="icon" type="image/png" href="favicon.png" />

        <style type="text/css">
        <%- SSR_CSS %>
        </style>

        <script type="text/javascript">
            window.dw = {
                backend: {
                    __api_domain: location.host.replace('app.', 'api.')
                }
            }
        </script>

        <style type="text/css">
            @font-face {
                font-family: 'Roboto';
                font-style: normal;
                font-weight: 500;
                src: local('Roboto Medium'), local('Roboto-Medium'), url('https://static.dwcdn.net/css/fonts/roboto/roboto_500.woff2') format('woff2'), url('https://static.dwcdn.net/css/fonts/roboto/roboto_500.woff') format('woff'), url('https://static.dwcdn.net/css/fonts/roboto/roboto_500.eot?#iefix') format('embedded-opentype'), url('https://static.dwcdn.net/css/fonts/roboto/roboto_500.svg#Roboto') format('svg'), url('https://static.dwcdn.net/css/fonts/roboto/roboto_500.ttf') format('truetype');
            }
        </style>

        <script type="text/javascript" src="/lib/requirejs/require.js"></script>
        <script type="text/javascript">
            requirejs.config({
                paths: {
                    lib: '/lib/csr',
                    dayjs: '/static/vendor/dayjs/dayjs.min',
                }
            });
        </script>

        <!-- This contains the contents of the <svelte:head> component, if
         the current page has one -->
        <%- SSR_HEAD %>
    </head>
    <body>
        <!-- The application will be rendered inside this element,
         because `src/client.js` references it -->
        <%- SSR_HTML %>

         <script>window.__DW_SVELTE_PROPS__ = { data: '/lib/polyfills' }</script>
         <script src="/lib/chart-core/load-polyfills.js"></script>
         <script>
             document.write('<script type="text/javascript" src="/lib/csr/<%= PAGE %>.'+(window.document.documentMode ? 'ie.' : '')+'js"></s'+'cript>');
         </script>
         <script async defer>
            require(['App'], function(App) {
                var props = <%- PAGE_PROPS %>;

                // todo: client-side caching

                var app = new App({
                  target: document.body,
                  props: props,
                  hydrate: true
                });

                <% if (DW_DEV_MODE) { %>
                new WebSocket(location.origin.replace('http', 'ws')+'/ws').onmessage = function(msg) {
                    const { page } = JSON.parse(msg.data);
                    if (page === '<%= PAGE %>') {
                        require(['/lib/csr/<%= PAGE %>.js?anonymous=1&rev='+Math.random()], function(App) {
                            app = new App({
                                target: document.body,
                                props: props,
                                hydrate: true
                            });
                        });
                    }
                }
                <% } %>
            });
         </script>
    </body>
</html>
